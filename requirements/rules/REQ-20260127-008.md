# REQ-20260127-008: Premium Dark Theme Migration (MPA-Compatible)

## Requirement Summary

**Objective:** Implement premium dark theme UI migration for all calculator pages while maintaining strict MPA (Multi-Page Application) architecture compliance.

**Scope:** All calculator pages across Math, Loans, and Time & Date categories

**Priority:** HIGH

**Change Type:** Layout/CSS (visual-only theme changes)

**Architecture Approach:** CSS-based theming with tokenized variables, fully compatible with MPA navigation

## Source Document

This requirement is based on the detailed theme tasks specification in [requirements/rules/general/newtheme_tasks.md](requirements/rules/general/newtheme_tasks.md).

## MPA Architecture Compliance

### AC-1 MPA Architecture Requirements
- [ ] **MAINTAINED:** Each calculator remains standalone HTML document
- [ ] **MAINTAINED:** Navigation uses `<a href>` links with full page reloads
- [ ] **MAINTAINED:** No SPA-style routing or dynamic content swapping
- [ ] **MAINTAINED:** Individual page SEO metadata and structured data
- [ ] **NO FRAMEWORK CHANGES:** Pure CSS + minimal vanilla JS implementation

### AC-2 Layout Contract (Hard Lock)
- [ ] **PRESERVED:** Grid column definitions (pane spans)
- [ ] **PRESERVED:** Pane container heights and scroll regions
- [ ] **PRESERVED:** `overflow-y-auto` regions remain unchanged
- [ ] **PRESERVED:** Header/footer heights (if fixed)
- [ ] **PRESERVED:** DOM structure for pane containers (no wrapper reshaping)
- [ ] **ENFORCEMENT:** Any change causing layout geometry differences must be reverted

## Theme Implementation Requirements

### TH-1 Theme Flag System
- [ ] Implement `data-theme="premium-dark"` attribute on `<html>` or `<body>`
- [ ] Default theme remains current until explicitly toggled
- [ ] Create `assets/css/theme-premium-dark.css` for new theme variables
- [ ] Include theme CSS after existing CSS files in all calculator pages
- [ ] Zero visual impact when theme flag is OFF

### TH-2 CSS Token Architecture
- [ ] Define CSS custom properties for all theme elements:
  - `--bg-main`, `--bg-pane`, `--text-primary`, `--text-muted`
  - `--border-soft`, `--shadow-soft`
  - `--accent-1`, `--accent-2` (blue/cyan gradients)
- [ ] Scope all theme changes under `[data-theme="premium-dark"]` selector
- [ ] No magic numbers duplicated across files

### TH-3 Premium Dark Visual Elements
- [ ] **Page Background:** Dark slate/blue gradient
- [ ] **Pane Surfaces:** Subtle gradients + translucency feel
- [ ] **Borders:** Low-contrast, soft borders
- [ ] **Button Styling:** 
  - Top category buttons: glossy gradient style
  - Left nav active items: gradient + soft shadow
  - Primary calculate button: blue â†’ cyan gradient
  - Hover/focus states with accessible focus rings
- [ ] **Slider Styling:**
  - Thumb style: rounded, accent colored
  - Track style: muted track + accent fill
  - Cross-browser support (webkit/moz selectors)
- [ ] **Typography:** Harmonized text colors using CSS tokens
- [ ] **Pane Headers:** Subtle gradient overlay treatment

## Implementation Tasks (Based on Theme Tasks Document)

### Task 0: Baseline Documentation
- [ ] Capture before screenshots of representative calculator pages
- [ ] Document current pane column spans and scroll regions
- [ ] Record layout contract constraints

### Task 1: Theme Flag + Token Foundation
- [ ] Add theme flag support (default OFF)
- [ ] Create theme-premium-dark.css with CSS variables
- [ ] Ensure zero visual change when flag is disabled

### Task 2: Premium Dark Backgrounds
- [ ] Implement page background gradient
- [ ] Style pane backgrounds with subtle gradients
- [ ] Apply soft borders and radius (no geometry changes)

### Task 3: Button Premium Styling
- [ ] Style top navigation category buttons
- [ ] Style left navigation active states
- [ ] Style primary calculate buttons
- [ ] Implement proper hover/focus states

### Task 4: Slider Premium Styling
- [ ] Implement custom slider thumb styling
- [ ] Implement track styling with accent fills
- [ ] Ensure cross-browser compatibility

### Task 5: Typography Harmonization
- [ ] Apply tokenized text colors throughout
- [ ] Ensure no line-wrapping or reflow issues
- [ ] Maintain accessibility contrast ratios

### Task 6: Pane Header Treatment
- [ ] Add premium gradient overlay to pane headers
- [ ] Maintain existing header heights and semantics

### Task 7: Visual Regression Testing
- [ ] Compare before/after screenshots
- [ ] Verify identical calculator outputs
- [ ] Confirm no layout geometry changes
- [ ] Test across all calculator categories

### Task 8: Documentation & Rollout
- [ ] Document theme activation process
- [ ] Create implementation guide for additional calculators
- [ ] Ensure theme works without page-specific overrides

## Quality Gates

### QG-1 MPA Compliance Verification
- [ ] All calculator navigation remains `<a href>` based
- [ ] Full page reloads confirmed between calculators
- [ ] No client-side routing introduced
- [ ] Each calculator page remains standalone

### QG-2 Layout Stability
- [ ] Before/after screenshot comparison shows only visual changes
- [ ] No pane width/height modifications
- [ ] No new horizontal/vertical scrollbars introduced
- [ ] All existing scroll regions preserved

### QG-3 Functional Integrity
- [ ] Calculator logic completely unchanged
- [ ] Input/output data contracts preserved
- [ ] Explanation pane content structure maintained
- [ ] Navigation structure and URLs unchanged

### QG-4 Performance & Accessibility
- [ ] Theme CSS file loads without errors
- [ ] No performance regression
- [ ] Accessibility contrast ratios maintained
- [ ] Keyboard focus rings visible and accessible

## Rollback Plan

- **Immediate Rollback:** Remove or disable `data-theme="premium-dark"` attribute
- **CSS Isolation:** Theme CSS can remain loaded but unused
- **Zero Dependencies:** No functional code depends on theme state
- **MPA Safety:** Each page loads independently, isolated rollback possible

## SEO Impact Assessment

**SEO Impact:** NONE - This is a visual-only change that:
- Does not modify URLs or navigation structure
- Does not change page content or metadata
- Does not affect crawlability or indexing
- Maintains server-side rendering approach

## Related Requirements & Constraints

- **UNIVERSAL_REQUIREMENTS.md:** Navigation Architecture (MPA compliance)
- **calculator-hierarchy.md:** Navigation structure preservation required
- **EXCL-1 Rules:** GTEP pages remain excluded from calculator shell styling
- **UI-3.1:** Fixed-height shell constraints must be preserved
- **Source:** [requirements/rules/general/newtheme_tasks.md](requirements/rules/general/newtheme_tasks.md)

## Risk Assessment

**LOW RISK:** CSS-only visual changes with theme flag safety
**MITIGATED:** Layout contract hard-lock prevents geometry issues  
**CONTROLLED:** Default-off theme flag allows safe testing and rollback

---

**Next Steps:**
1. Human trigger: `EVT_START_BUILD REQ-20260127-008`
2. Begin with Task 0 baseline documentation
3. Implement tasks 1-8 in sequence with verification gates