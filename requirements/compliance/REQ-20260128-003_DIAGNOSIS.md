# Credit Card Repayment/Payoff Calculator Diagnosis Report

## REQ-20260128-003

**Date:** 2026-01-28
**Status:** TESTING - Root Cause Identified

---

## Executive Summary

The Credit Card Repayment/Payoff Calculator is **not working** because the generated page does not include the JavaScript module that contains the calculator logic. While the HTML structure, inputs, and UI elements are present, no event listeners or calculation functions are loaded, making the calculator non-functional.

---

## Root Cause

**Missing Script Tag in Generated Pages**

The [scripts/generate-mpa-pages.js](scripts/generate-mpa-pages.js) script generates MPA pages with calculator HTML fragments embedded, but fails to inject a `<script type="module">` tag that loads the calculator's `module.js` file.

### Evidence

1. **Credit Card Repayment/Payoff Page** ([public/loans/credit-card-repayment-payoff/index.html](public/loans/credit-card-repayment-payoff/index.html))
   - Has HTML inputs and structure (lines 87-154)
   - Has explanation panel (lines 158-190)
   - **Missing:** `<script type="module" src="/calculators/loans/credit-card-repayment-payoff/module.js"></script>`
   - Only includes: `<script type="module" src="/assets/js/core/mpa-nav.js"></script>` (line 213)

2. **Home Loan Calculator** ([public/loans/home-loan/index.html](public/loans/home-loan/index.html))
   - Same issue - missing module.js script tag

3. **Car Loan Calculator** ([public/loans/car-loan/index.html](public/loans/car-loan/index.html))
   - **WORKS CORRECTLY** - has `<script type="module" src="/calculators/loans/car-loan/module.js"></script>` (line 202)
   - This suggests the car-loan was manually fixed or built differently

---

## Technical Details

### Calculator Components Status

| Component | Status | Location |
|-----------|--------|----------|
| HTML Fragment (index.html) | ✓ Present | [public/calculators/loans/credit-card-repayment-payoff/index.html](public/calculators/loans/credit-card-repayment-payoff/index.html) |
| JavaScript Module (module.js) | ✓ Present | [public/calculators/loans/credit-card-repayment-payoff/module.js](public/calculators/loans/credit-card-repayment-payoff/module.js) |
| Explanation (explanation.html) | ✓ Present | [public/calculators/loans/credit-card-repayment-payoff/explanation.html](public/calculators/loans/credit-card-repayment-payoff/explanation.html) |
| Utility Functions | ✓ Present | [public/assets/js/core/credit-card-utils.js](public/assets/js/core/credit-card-utils.js) |
| Navigation Entry | ✓ Registered | [public/config/navigation.json:430-432](public/config/navigation.json#L430-L432) |
| Generated Page | ✓ Exists | [public/loans/credit-card-repayment-payoff/index.html](public/loans/credit-card-repayment-payoff/index.html) |
| **Module Script Tag** | **✗ MISSING** | Should be in generated page before `</body>` |

### Module.js Analysis

The [module.js](public/calculators/loans/credit-card-repayment-payoff/module.js) file:
- ✓ Imports correct utility functions ([credit-card-utils.js:3](public/assets/js/core/credit-card-utils.js#L3))
- ✓ Selects DOM elements correctly (lines 5-28)
- ✓ Defines calculation logic (lines 98-135)
- ✓ Attaches event listener to button (line 137)
- ✓ Calls `calculate()` on load (line 139)

**The code is correct, but never executes because the script tag is missing.**

---

## Impact

**Severity:** HIGH

1. **User Experience:** Calculator appears broken - button clicks do nothing
2. **Scope:** Affects all calculators generated by `generate-mpa-pages.js` (except those manually fixed like car-loan)
3. **Data Loss:** No calculation results displayed
4. **SEO Impact:** Page exists but provides no functional value

---

## Required Fix

Modify [scripts/generate-mpa-pages.js](scripts/generate-mpa-pages.js) `buildPageHtml` function (lines 307-395) to:

1. Accept a `calculatorId` parameter
2. Inject calculator-specific module.js script tag before closing `</body>`

**Example Fix Location:**
```javascript
// Current (line 391-393):
<script type="module" src="/assets/js/core/mpa-nav.js"></script>
</body>

// Should be:
<script type="module" src="/assets/js/core/mpa-nav.js"></script>
<script type="module" src="/calculators/${relPath}/module.js"></script>
</body>
```

---

## Testing Checklist

Once fixed, verify:
- [ ] Generated page includes module.js script tag
- [ ] Calculator calculates correctly with default values
- [ ] Result displays in `#cc-payoff-result` div
- [ ] Summary displays in `#cc-payoff-summary` div
- [ ] Graph updates with balance line
- [ ] Explanation panel updates with calculated values
- [ ] Yearly table populates with data
- [ ] Error messages display for invalid inputs

---

## Related Requirements

- REQ-20260128-002: Credit Card Repayment / Payoff Calculator Not Working (bugfix)
- REQ-20260128-003: Test and Diagnose Repayment / Payoff Calculator (this requirement)

---

## Next Steps

1. Fix `generate-mpa-pages.js` to inject module.js script tags
2. Regenerate all MPA pages
3. Test credit-card-repayment-payoff calculator
4. Verify other calculators still work
5. Update REQ-20260128-002 status to IN_PROGRESS
6. Mark REQ-20260128-003 as COMPLETE
